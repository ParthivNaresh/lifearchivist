

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>lifearchivist.tools.date_extract.date_extraction_utils &mdash; Life Archivist 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Life Archivist
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../installation.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../installation.html#system-dependencies">System Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../installation.html#macos">macOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../installation.html#linux">Linux</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../installation.html#installation-steps">Installation Steps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../installation.html#clone-the-repository">1. Clone the Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../installation.html#install-dependencies">2. Install Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../installation.html#start-services">3. Start Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../installation.html#verify-installation">4. Verify Installation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../installation.html#quick-start">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../installation.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../installation.html#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart.html">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../quickstart.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../quickstart.html#starting-life-archivist">Starting Life Archivist</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../quickstart.html#first-time-setup">First Time Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../quickstart.html#basic-usage">Basic Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../quickstart.html#importing-files">Importing Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../quickstart.html#searching">Searching</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../quickstart.html#asking-questions">Asking Questions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../quickstart.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../configuration.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../configuration.html#environment-variables">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../configuration.html#key-configuration-options">Key Configuration Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../configuration.html#storage-settings">Storage Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../configuration.html#model-settings">Model Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../configuration.html#service-urls">Service URLs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../configuration.html#api-settings">API Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../configuration.html#feature-flags">Feature Flags</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../configuration.html#advanced-configuration">Advanced Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../configuration.html#logging">Logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../configuration.html#performance-tuning">Performance Tuning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../configuration.html#security">Security</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../configuration.html#configuration-file">Configuration File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../configuration.html#validation">Validation</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../usage/overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../usage/overview.html#features">Features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../usage/file-management.html">File Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../usage/search.html">Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../usage/ai-features.html">AI Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/modules.html">lifearchivist</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../api/lifearchivist.html">lifearchivist package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/lifearchivist.html#subpackages">Subpackages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/lifearchivist.agents.html">lifearchivist.agents package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/lifearchivist.config.html">lifearchivist.config package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/lifearchivist.models.html">lifearchivist.models package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/lifearchivist.schemas.html">lifearchivist.schemas package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/lifearchivist.server.html">lifearchivist.server package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/lifearchivist.storage.html">lifearchivist.storage package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/lifearchivist.tools.html">lifearchivist.tools package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/lifearchivist.utils.html">lifearchivist.utils package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/lifearchivist.html#module-lifearchivist">Module contents</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/lifearchivist.html#lifearchivist.Document"><code class="docutils literal notranslate"><span class="pre">Document</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/lifearchivist.html#lifearchivist.SearchResult"><code class="docutils literal notranslate"><span class="pre">SearchResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/lifearchivist.html#lifearchivist.LlamaIndexService"><code class="docutils literal notranslate"><span class="pre">LlamaIndexService</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../development/setup.html">Development Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development/architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development/testing.html">Testing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Life Archivist</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">lifearchivist.tools.date_extract.date_extraction_utils</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for lifearchivist.tools.date_extract.date_extraction_utils</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Date extraction utilities and constants for document date parsing.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="n">SUPPORTED_DATE_FORMATS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># 2024-01-15 (ISO format - preferred by LLM)</span>
    <span class="s2">&quot;%B </span><span class="si">%d</span><span class="s2">, %Y&quot;</span><span class="p">,</span>  <span class="c1"># January 15, 2024</span>
    <span class="s2">&quot;%B </span><span class="si">%d</span><span class="s2"> %Y&quot;</span><span class="p">,</span>  <span class="c1"># January 15 2024</span>
    <span class="s2">&quot;%b </span><span class="si">%d</span><span class="s2">, %Y&quot;</span><span class="p">,</span>  <span class="c1"># Jan 15, 2024</span>
    <span class="s2">&quot;%b </span><span class="si">%d</span><span class="s2"> %Y&quot;</span><span class="p">,</span>  <span class="c1"># Jan 15 2024</span>
    <span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y&quot;</span><span class="p">,</span>  <span class="c1"># 01/15/2024</span>
    <span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%y&quot;</span><span class="p">,</span>  <span class="c1"># 01/15/24</span>
    <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">,</span>  <span class="c1"># 15/01/2024 (European format)</span>
<span class="p">]</span>


<span class="n">DATE_EXTRACTION_PROMPT_TEMPLATE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;You are a document date extraction expert. Your goal is to find the PRIMARY DATE when this document was created, issued, or sent out. This is typically found at the top of the document.</span>

<span class="s2">WHAT TO LOOK FOR:</span>
<span class="s2">1. **Statement Date** - When the statement/bill was issued</span>
<span class="s2">2. **Document Date** - When the document was created/printed</span>
<span class="s2">3. **Issue Date** - When the document was sent out</span>
<span class="s2">4. **Report Date** - When the report was generated (for test results, reports)</span>
<span class="s2">5. **Payroll Date** - When the paycheck/paystub was issued or sent</span>
<span class="s2">6. **Account Statement Date** - The ending date range for the account statement time period</span>

<span class="s2">PRIORITY ORDER (look for the FIRST/HIGHEST priority date you can find):</span>
<span class="s2">1. Statement Date, Issue Date, Document Date (TOP PRIORITY)</span>
<span class="s2">2. Report Date, Test Date, Generated Date</span>
<span class="s2">3. Closing Date, As of Date (for account statements)</span>
<span class="s2">4. Creation Date, Print Date</span>

<span class="s2">IGNORE these dates:</span>
<span class="s2">- Service periods (&quot;January 1 - 31, 2022&quot; coverage periods)</span>
<span class="s2">- Due dates (&quot;Payment due by...&quot;)  </span>
<span class="s2">- Transaction dates (individual purchases/payments)</span>
<span class="s2">- Appointment dates within the document content</span>

<span class="s2">DOCUMENT TEXT:</span>
<span class="si">{text}</span>

<span class="s2">FIND THE MAIN DOCUMENT DATE - typically near the top of the document.</span>

<span class="s2">EXAMPLES:</span>
<span class="s2">- &quot;Statement Date: March 29, 2022&quot; → date: &quot;2022-03-29&quot;</span>
<span class="s2">- &quot;Report Date: 05/26/2022&quot; → date: &quot;2022-05-26&quot;  </span>
<span class="s2">- &quot;Issued: February 15, 2022&quot; → date: &quot;2022-02-15&quot;</span>
<span class="s2">- &quot;Lab Results - Date: 01/28/2022&quot; → date: &quot;2022-01-28&quot;</span>

<span class="s2">### VERY IMPORTANT</span>
<span class="s2">Return ONLY ONE DATE - the primary document creation/issue date. Do this without any additional commentary.</span>
<span class="s2">Don&#39;t include any other output text besides the date.</span>

<span class="s2">DATE OUTPUT:&quot;&quot;&quot;</span>


<div class="viewcode-block" id="create_date_extraction_prompt">
<a class="viewcode-back" href="../../../../api/lifearchivist.tools.date_extract.html#lifearchivist.tools.date_extract.date_extraction_utils.create_date_extraction_prompt">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_date_extraction_prompt</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a comprehensive prompt for LLM-based date extraction.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Document text content to analyze</span>

<span class="sd">    Returns:</span>
<span class="sd">        Formatted prompt for LLM date extraction</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">DATE_EXTRACTION_PROMPT_TEMPLATE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)</span></div>



<div class="viewcode-block" id="parse_date_string">
<a class="viewcode-back" href="../../../../api/lifearchivist.tools.date_extract.html#lifearchivist.tools.date_extract.date_extraction_utils.parse_date_string">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">parse_date_string</span><span class="p">(</span><span class="n">date_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse various date string formats into datetime objects.</span>

<span class="sd">    Args:</span>
<span class="sd">        date_str: Date string to parse</span>

<span class="sd">    Returns:</span>
<span class="sd">        Parsed datetime object or None if parsing fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">date_str</span> <span class="o">=</span> <span class="n">date_str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="n">SUPPORTED_DATE_FORMATS</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parsed_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">parsed_date</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">continue</span>
    <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="truncate_text_for_llm">
<a class="viewcode-back" href="../../../../api/lifearchivist.tools.date_extract.html#lifearchivist.tools.date_extract.date_extraction_utils.truncate_text_for_llm">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">truncate_text_for_llm</span><span class="p">(</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_chars</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">document_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Truncate text to avoid LLM token limits while preserving beginning content.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Text content to potentially truncate</span>
<span class="sd">        max_chars: Maximum character limit</span>
<span class="sd">        document_id: Optional document ID for logging</span>

<span class="sd">    Returns:</span>
<span class="sd">        Truncated text with ellipsis if needed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_chars</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span>

    <span class="n">truncated_text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="n">max_chars</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span>

    <span class="k">return</span> <span class="n">truncated_text</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Life Archivist Contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>